<div class="playerContainer">
	<div #youtubePlayer class="youtubePlayer" [ngClass]="{hide: selectedTrack.source !== 'Youtube' || selectedTrackAsYoutubeTrack.isGraphicsActive === false}">
		<youtube-player videoId="{{selectedTrackAsYoutubeTrack.youtubeId}}" (ready)="onPlayerReady ($event)" (change)="onPlayerStateChange($event)"></youtube-player>
	</div>
	<div>
		<canvas #WebGLCanvas id="WebGLCanvas" style="border: none;position: absolute" width="800" height="600"></canvas>
		<script id="v_background" type="x-shader/x-vertex">
			 attribute vec3 vertex;
			void main(void) {
					gl_Position = vec4(vertex, 1.0);
				}
		</script>

		<script id="f_background" type="x-shader/x-fragment">
			precision mediump float;
			uniform vec4 uColor;
			void main(void) {
				gl_FragColor = uColor;
			}
		</script>

		<script id="v_solid" type="x-shader/x-vertex">
			 attribute vec3 vertex;

			 uniform mat4 uProjection;
			 uniform mat4 uView;
			 uniform mat4 uModel;

			varying vec3 fragPosition;
			void main(void) {
				fragPosition = vertex;
				mat4 modelView = uView * uModel;
				// normal = modelView * inputNormal
					gl_Position = uProjection * modelView * vec4(vertex, 1.0);
				}
		</script>

		<script id="f_solid" type="x-shader/x-fragment">
			precision mediump float;
			varying vec3 fragPosition;
			uniform vec3 uColor;
			void main(void) {
				vec3 color = uColor + .1*length(fragPosition);
				gl_FragColor = vec4(color, 1.0);
			}
		</script>

		<script id="f_text" type="x-shader/x-fragment">
			precision mediump float;
			varying vec3 fragPosition;
			uniform vec3 uColor;
			void main(void) {
				//vec3 color = uColor + .1*length(fragPosition);
				gl_FragColor = vec4(uColor, 1.0);
			}
		</script>

		<script id="f_plasma" type="x-shader/x-fragment">
			#extension GL_OES_standard_derivatives : enable
			precision mediump float;
			varying vec3 fragPosition;

			uniform float uTime;
			uniform vec2 uMix;

			float hash( float n ) { return fract(sin(n)*43758.5453); }

			float noise( in vec2 x ) {
					vec2 p = floor(x);
					vec2 f = fract(x);

					f = f*f*(3.0-2.0*f);
					float n = p.x + p.y*57.0;
					return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
												 mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
			}

			const float PI=3.1415926;
			const vec2 iResolution = vec2(80., 80.);

			void main() {
				float bt = uTime*(85./60.);
				float t = floor(bt) + pow(fract(bt), 3.);

				vec2 uv = (fragPosition.xz / iResolution.xy);
				vec3 s = vec3(uv, uv.x*uv.y);
				vec3 p = vec3(0.);

				p += sin(s.x*3. + t*.7 + 8.);
				p += sin(s.y*2. + t*.3 + 5.);
				p += sin(s.z*5. + t*.4 - 1.);
				p += sin(s + t);
				p += sin(dot(uv, uv) + t);

					vec3 plasma = .5 + .5 * sin(PI * (p + vec3(0.0, 0.5, 1.0)));

					vec2 grid = mod(fragPosition.xz*.5, vec2(1.));

					float f = abs(mix(fwidth(fragPosition.x), fwidth(fragPosition.y), .5));
				float c =  min(
					smoothstep(0., .05 + f*.5, abs(grid.x-.5)),
					smoothstep(0., .05 + f*.5, abs(grid.y-.5))
				);
				float c2 = 1. - .25*noise(floor(.25*fragPosition.xz + .25));
				vec3 shader = vec3(min(1.,f + c) * c2);
				vec3 bw = vec3((plasma.x+plasma.y+plasma.z)/3.);

				vec3 color = mix(shader, mix(bw, plasma, uMix.y), .9*uMix.x);

					gl_FragColor = vec4(color, 1);
			}
		</script>


	</div>
	<div class="myPlayer noSelect" [ngClass]="{hide: selectedTrackAsYoutubeTrack !== null && selectedTrackAsYoutubeTrack.isGraphicsActive === true}">
		<span class="playIconContainer" (click)="onPlayPauseBtn()">
			<div [ngClass]="{playing: playState === 'Playing', loading: playState === 'Loading', stopped: playState === 'Paused' || playState === 'Stopped'}"></div>
		</span>
		<span class="nextContainer" (click)="onNextBtn()">
			<div class="next_triangle"></div>
			<div class="next_line"></div>
		</span>
		<span class="trackName">
			<span>{{selectedTrack.name}}</span>

			</span>
		<span class="playerRightButtonsContainer">
			<span class="shuffleContainer" (click)="onShuffleBtn()">
				<div class="shuffle" [ngClass]="{shuffleOn: isShuffle, shuffleOff: !isShuffle}"></div>
			</span>
			<span class="muteContainer" (click)="onMasterMuteBtn()">
				<div [ngClass]="{mute: masterMuted, unmute: !masterMuted, muteDisabled: gainsDisabled && masterMuted, unmuteDisabled: gainsDisabled && !masterMuted}"></div>
			</span>
			<span class="sliderContainer">
				<span class="slider">
				<ngx-slider [(value)]="masterGain" [options]="optionsMasterGain"></ngx-slider>
				</span>
			</span>
		</span>
	</div>
</div>
<iframe id="scWidget" class="hide" width="100%" height="10" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/1255416709&color=%23ff5500&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&buying=false&liking=false&download=false&sharing=false&show_artwork=false&show_playcount=false&start_track=0"></iframe>
