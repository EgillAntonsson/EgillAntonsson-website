<h2>Building with the bleeps and bloops and the 1s and 0s</h2>


<p><a href='https://medium.com/pragmatic-programmers/3-3-the-tdd-cycle-red-green-refactor-b2d9925518a0'>The TDD Cycle: Red-Green-Refactor</a></p>

<p><a href='https://zelda.fandom.com/wiki/Life_Gauge'>Life Gauge description on Zelda Wiki</a></p>


<p>
	After getting the description that relates to the Heart Gauge from our hypothetical game designer,<br>
	and iterating it with her/him, we define terminology map, and the list of functional requirements:
</p>

<p>
	Mapping out separations of concerns and terms within the main 'Life Gouge' term.<br>
</p>
<table>
	<tr>
		<th>Model / Non-Visual Logic</th>
		<th>View / Visual (logic*)</th>
	</tr>
	<tr>
		<td class="center">
			Health
		</td>
		<td class="center">
			Heart Container
		</td>
	</tr>
	<tr>
		<td class="center">
				-
		</td>
		<td class="center">
			Heart (contains 4 Fractions)
		</td>
	</tr>
	<tr>
		<td class="center">
			Health Points
		</td>
		<td class="center">
			Heart Fraction
		</td>
	</tr>
</table>
<sup>* the View can have some logic, but it should only be about visual and minimal</sup>
<p>
	The want the code dependency to be minimal and one-way,<br>
	View can depend on Model (but not vice-versa).
</p>

<p>
	We focus first on Health model's functional requirements.<br>
	It can be broken into main 3 areas:
</p>
<ul>
	<li>Health starting state</li>
	<li>Health taking damage</li>
	<li>Health healing</li>
</ul>
<p>
	In this blog post I'll focus on the first bulletin,<br>
	and I'll flesh it further out, as I iterate through the TDD cycles.<br>
	(I aim to tackle the other areas in following blog posts of this series).
</p>
<ul>
	<li>Health starting state</li>
		<ul>
			<li>Health Points starting value (12, which visually equals 3 Hearts)</li>
			<li>...</li>
		</ul>
</ul>

<hr>
<h3>Health Points starting value (12)</h3>
<p><span class="redFail">RED:</span>
	We define our test class and our first test.<br>
	The test is failing as the code does not even compile.
</p>
<pre><code [highlight]="test_1_Red"></code></pre>

<p><span class="greenPass">GREEN:</span> Let's make the test pass by defining a simple implementation.
</p>
<pre><code [highlight]="impl_1_Green"></code></pre>

<p><span class="greenRefactor">REFACTOR:</span> Now it comes to mind that from a game design perspective,<br>
	it is good to be able to tweak the starting value,for game balancing<br>
	Thus I refactor the value to be passed as parameter to the constructor.<br>
	I also encapsulate 'Points' with 'private set',<br>
	as I want to <a href="https://medium.com/swlh/the-importance-of-code-encapsulation-ce19efbcfe57"> encapsulate the implementation</a> as much as possible.
</p>
<pre><code [highlight]="code_1_Refactor"></code></pre>
<p>
	Passing in the value is sufficient from the Health class perspective.<br>
	Where the value is defined, and how it is integrated in the code base,<br>
	is out of scope (but would be done in a finalized real-life scenario)<br>
</p>

<hr>

<p>
	Now it comes to mind that Health should handle invalid starting value for Points,<br>
it can not be less than 1, as Link would then start being dead on arrival :)<br>
	So let's refine our requirement list, and begin our next TDD cycle<br>
</p>


<ul>
	<li>Health starting state</li>
		<ul>
			<li>Health Points starting value &#9989;</li>
			<li>Handle invalid starting value for Health Points (less than 1)</li>
		</ul>
</ul>

<h3>Handle invalid starting value for Health Points (less than 1)</h3>
<p><span class="redFail">RED:</span>
	I deem it appropriate to throw an exception in this case.<br>
	Also the invalid value should be handled early and close to the value definition (out of scope),<br>
	which makes the thrown exception in Health class the 'last line of defence'.<br>
	(An alternative, not worth to go for at this point,<br>
	would be to correct the invalid value to a predefined valid value (e.g. 12),<br>
	and put in place an accessible logger system, that logs this handling with an informative message.)<br>
</p>
<pre><code [highlight]="test_2_Red"></code></pre>

<p>
	I deem that existing ArgumentOutOfRangeException from System can be used.<br>
	I chose the value '0' as it's on the valid/invalid 'edge'.
</p>

<p><span class="greenPass">GREEN:</span> Let's make the test pass.<br>
 If value is invalid I throw the exception with an informative error message<br>
</p>
<pre><code [highlight]="impl_2_Green"></code></pre>

<p>The 'GREEN' implementation in this case,<br>
	is also the proper generic solution,<br>
	in other words I did GREEN and REFACTOR in one step.<br>
	The code in whole looks pretty good, so no refactoring needed in this cycle.
</p>

<hr>
<p>The implementation is simple enough that I'm confident that it works for any passed-in starting value.<br>
	But for the purpose of further TDD demonstration,<br>
	let's add couple oft.</p>

<p><span class="greenRefactor">REFACTOR:</span> Adding test cases where the value is close to the valid/invalid 'edge',<br>
	using <a href="https://docs.nunit.org/articles/nunit/technical-notes/usage/Parameterized-Tests.html">Parameterized Tests</a> with inline <a href="https://docs.nunit.org/articles/nunit/writing-tests/attributes/testcase.html">Test Case attribute</a>.
</p>
<pre><code [highlight]="test_3_Green"></code></pre>

<p>
	This runs in total 4 test cases and Unity Test Runner looks like this:
</p>
<ul>
	<li>HealthTest+PointsTest</li>
		<ul>
			<li>HasStartingValue
				<ul>
					<li>&#9989; HasStartingValue(12)</li>
					<li> &#9989; HasStartingValue(1)</li>
				</ul>
			</li>
			<li>ThrowsError_WhenStartingValueIsInvalid
				<ul>
					<li>&#9989; ThrowsError_WhenStartingValueIsInvalid(0)</li>
					<li>&#9989; ThrowsError_WhenStartingValueIsInvalid(-1)</li>
				</ul>
			</li>
		</ul>
</ul>

<hr>

<p>This concludes the first bulletin on our requirement list, and this blog post.<br>
	I aim to continue with the list in following blog posts, so let's end it with the viewing the list.
</p>

<ul>
	<li>Health starting state</li>
		<ul>
			<li>Health Points starting value &#9989;</li>
			<li>Handle invalid starting value for Health Points &#9989;</li>
		</ul>
	<li>Health taking damage</li>
		<ul>
			<li>... to be fleshed out</li>
		</ul>
	<li>Health healing</li>
		<ul>
			<li>... to be fleshed out</li>
		</ul>
</ul>
